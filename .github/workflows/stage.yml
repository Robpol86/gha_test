name: Deploy to Stage

on:
  push:

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
      - {name: Check out repository code, uses: actions/checkout@v2, with: {fetch-depth: 0}}
      - run: mkdir -p build/html && echo helloworld > $_/index.html
      - {name: Store HTML, uses: actions/upload-artifact@v2, with: {name: html, path: build/html/, if-no-files-found: error}}

  prerelease:
    runs-on: ubuntu-latest
    needs: build
    if: "github.ref == 'refs/heads/main' && contains(github.event.head_commit.message, ' (#')"
    steps:
      - name: Gather data
        id: data
        run: echo TODO
      - name: Fetch HTML files
        uses: actions/download-artifact@v2
        with: {name: html, path: html}
      - name: Archive HTML files
        run: tar -czvf html.tar.gz html/
#      - name: Create prerelease
#        uses: softprops/action-gh-release@v1
#        with: {prerelease: true, files: "html.tar.gz", name: "${{ steps.data.name }}", body_path: ./...txt}
